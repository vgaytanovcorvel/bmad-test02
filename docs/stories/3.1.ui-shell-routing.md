# Story 3.1: UI Shell & Routing

## Status
Draft

## Story
**As a** user of the tic-tac-toe application,
**I want** a responsive shell with routing for game, health check, and credits pages,
**so that** I can navigate between different sections while having an optimal experience on both mobile and desktop with properly centered board and inline controls.

## Acceptance Criteria
1: Routes: `/` (game), `/health`, `/credits`.
2: Board centered, controls inline (size, mode, new game).
3: Layout responsive (mobile & desktop) maintaining square cells.

## Tasks / Subtasks

- [ ] **Task 1: Setup Core Routing Infrastructure** (AC: 1)
  - [ ] Update `app.routes.ts` to define all three required routes
  - [ ] Configure game page as default route (`/`)
  - [ ] Setup lazy loading for health and credits components
  - [ ] Implement proper route titles and navigation
  - [ ] Remove existing redirect to health page

- [ ] **Task 2: Create Game Page Component** (AC: 1, 2)
  - [ ] Create `GameComponent` in `apps/ui/src/app/pages/game/`
  - [ ] Implement basic shell structure with centered board layout
  - [ ] Add placeholder for board component integration
  - [ ] Setup inline controls layout structure (size, mode, new game)
  - [ ] Apply Tailwind CSS responsive design patterns

- [ ] **Task 3: Create Credits Page Component** (AC: 1)
  - [ ] Create `CreditsComponent` in `apps/ui/src/app/pages/credits/`
  - [ ] Implement basic credits page structure
  - [ ] Setup responsive layout matching app shell design
  - [ ] Add navigation back to game page
  - [ ] Include placeholder content for future epic implementation

- [ ] **Task 4: Update App Shell and Navigation** (AC: 1, 3)
  - [ ] Update main `app.ts` component with navigation shell
  - [ ] Implement responsive navigation component with route links
  - [ ] Setup proper routing active states and accessibility
  - [ ] Ensure navigation works across mobile and desktop viewports
  - [ ] Configure router outlet for page components

- [ ] **Task 5: Implement Responsive Layout System** (AC: 2, 3)
  - [ ] Setup CSS custom properties for responsive board sizing
  - [ ] Configure Tailwind grid system for 3x3 and 4x4 layouts
  - [ ] Implement mobile-first responsive breakpoints
  - [ ] Ensure square cell ratio maintenance across screen sizes
  - [ ] Setup centered board layout with proper spacing

- [ ] **Task 6: Verify Health Page Integration** (AC: 1)
  - [ ] Verify existing `HealthComponent` works with new routing
  - [ ] Update health page layout to match app shell design
  - [ ] Ensure health page is accessible via `/health` route
  - [ ] Test navigation between all three pages
  - [ ] Validate responsive behavior on health page

- [ ] **Task 7: Testing and Quality Assurance** (AC: 1, 2, 3)
  - [ ] Create unit tests for all new page components
  - [ ] Test route navigation and lazy loading functionality
  - [ ] Verify responsive layout behavior across breakpoints
  - [ ] Test accessibility of navigation and routing
  - [ ] Create basic E2E test for page navigation flow

## Dev Notes

### Previous Story Insights
Story 2.7 completed the engine configuration factory pattern with comprehensive validation and testing. All 264 engine tests are passing. The engine now has complete game configuration support including board sizes (3x3, 4x4), k-value configuration, initial player settings, and game mode selection. Key patterns established include immutable configuration propagation, factory pattern implementation, and comprehensive validation.

[Source: docs/stories/2.7.configuration-and-mode-selection.md]

### Architecture and Tech Stack Foundation
[Source: docs/architecture/ADR-001-tech-stack.md]

**Core Framework Stack:**
- **Angular 17+**: Standalone components with modern signal-based reactivity
- **Angular Router**: Built-in routing with lazy loading support
- **Tailwind CSS 3.x**: Utility-first responsive design system
- **TypeScript 5.x**: Strict type safety and modern language features
- **Nx**: Monorepo tooling for modular architecture

**Component Architecture Standards:**
- Standalone components using Angular 17+ patterns
- OnPush change detection for performance optimization
- Signal-based reactivity with computed derived state
- Dependency injection using `inject()` function
- New control flow syntax (`@if`, `@for`)
- Data-testid attributes for reliable test selectors

[Source: docs/ui-architecture/component-architecture-standards.md]

### Current Project Structure Context
[Source: docs/ui-architecture/project-structure.md]

**Existing File Structure:**
```
apps/ui/src/app/
├── pages/
│   └── health/              # Existing health component
├── components/              # Available for shared components
├── services/                # Available for Angular services
├── app.routes.ts           # Needs updating for new routes
├── app.config.ts           # App configuration
└── app.ts                  # Main app component (needs shell)
```

**Required New Structure:**
```
apps/ui/src/app/pages/
├── game/
│   ├── game.component.ts    # New game page component
│   ├── game.component.html
│   ├── game.component.scss
│   └── game.component.spec.ts
├── credits/
│   ├── credits.component.ts # New credits page component
│   ├── credits.component.html
│   ├── credits.component.scss
│   └── credits.component.spec.ts
└── health/                  # Existing, verify integration
```

### Routing Configuration Requirements
[Source: docs/ui-architecture/routing-configuration.md]

**Required Route Configuration:**
```typescript
// app.routes.ts - Required implementation
export const appRoutes: Route[] = [
  {
    path: '',
    loadComponent: () => import('./pages/game/game.component').then(m => m.GameComponent),
    title: 'Tic Tac Toe'
  },
  {
    path: 'health',
    loadComponent: () => import('./pages/health/health.component').then(m => m.HealthComponent),
    title: 'Health Check'
  },
  {
    path: 'credits',
    loadComponent: () => import('./pages/credits/credits.component').then(m => m.CreditsComponent),
    title: 'Credits'
  },
  {
    path: '**',
    redirectTo: ''
  }
];
```

**Navigation Component Pattern:**
```typescript
@Component({
  selector: 'app-navigation',
  standalone: true,
  imports: [RouterModule],
  template: `
    <nav class="main-nav" role="navigation" aria-label="Main navigation">
      <a routerLink="/" 
         routerLinkActive="active" 
         [routerLinkActiveOptions]="{exact: true}"
         class="nav-link"
         aria-label="Game page">
        Game
      </a>
      <a routerLink="/health" 
         routerLinkActive="active"
         class="nav-link"
         aria-label="Health check page">
        Health
      </a>
      <a routerLink="/credits" 
         routerLinkActive="active"
         class="nav-link"
         aria-label="Credits page">
        Credits
      </a>
    </nav>
  `
})
export class NavigationComponent {}
```

### Responsive Layout System Design
[Source: docs/ui-architecture/styling-guidelines.md]

**CSS Custom Properties for Responsive Board:**
```scss
// Required in global styles or component
:root {
  --game-board-size: 300px;
  --cell-size: calc(var(--game-board-size) / var(--board-dimension));
  --board-dimension: 3; // Dynamic based on game mode
  
  // Responsive breakpoints
  @media (max-width: 640px) {
    --game-board-size: 280px;
  }
  
  @media (max-width: 480px) {
    --game-board-size: 260px;
  }
}

.board-4x4 {
  --board-dimension: 4;
}
```

**Game Page Layout Pattern:**
```typescript
// Game component template structure
template: `
  <div class="game-page-container">
    <header class="game-header">
      <h1>Tic Tac Toe</h1>
    </header>
    
    <main class="game-main">
      <div class="game-board-container">
        <!-- Board component will be integrated here -->
        <div class="board-placeholder"></div>
      </div>
      
      <div class="game-controls-inline">
        <!-- Controls: size toggle, mode toggle, new game -->
        <div class="control-group">
          <button>3x3 / 4x4</button>
          <button>Human vs Human / Human vs Computer</button>
          <button>New Game</button>
        </div>
      </div>
    </main>
  </div>
`
```

**Tailwind Responsive Grid Configuration:**
```scss
// Board responsive grid classes
.game-board {
  @apply grid gap-2 p-4 bg-white rounded-lg shadow-lg mx-auto;
  
  width: var(--game-board-size);
  height: var(--game-board-size);
  
  // Dynamic grid columns based on board size
  &.board-3x3 {
    @apply grid-cols-3;
  }
  
  &.board-4x4 {
    @apply grid-cols-4;
  }
}

.game-controls-inline {
  @apply flex flex-wrap justify-center gap-4 mt-6;
  
  .control-group {
    @apply flex flex-wrap gap-2;
    
    button {
      @apply px-4 py-2 bg-primary-500 text-white rounded hover:bg-primary-600 
             focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
             transition-colors duration-150;
    }
  }
}
```

### Current App Component Context
[Source: Current app.ts file structure]

**Current App Component Status:**
- Exists as `app.ts` (not `app.component.ts`)
- Needs shell structure with navigation and router outlet
- Currently minimal implementation needs extension

**Required App Shell Implementation:**
```typescript
@Component({
  selector: 'app-root',
  standalone: true,
  imports: [RouterOutlet, NavigationComponent],
  template: `
    <div class="app-shell">
      <app-navigation></app-navigation>
      <main class="app-content">
        <router-outlet></router-outlet>
      </main>
    </div>
  `,
  styleUrl: './app.component.scss'
})
export class AppComponent {}
```

### Component Architecture Implementation Patterns
[Source: docs/ui-architecture/component-architecture-standards.md]

**Page Component Template:**
```typescript
import { Component, ChangeDetectionStrategy } from '@angular/core';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-game',
  standalone: true,
  imports: [CommonModule],
  template: `
    <div class="game-page" data-testid="game-page">
      <!-- Game page content -->
    </div>
  `,
  styleUrl: './game.component.scss',
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class GameComponent {}
```

**Testing Pattern for Components:**
```typescript
describe('GameComponent', () => {
  let component: GameComponent;
  let fixture: ComponentFixture<GameComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [GameComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(GameComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should render game page', () => {
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('[data-testid="game-page"]')).toBeTruthy();
  });
});
```

### Game Engine Integration Context
[Source: Engine implementation status from previous stories]

**Engine Factory Available:**
```typescript
// From completed Story 2.7
import { EngineFactory, GameConfig } from '@libs/engine';

// 3x3 game setup
const config3x3: GameConfig = {
  boardSize: 3,
  kInRow: 3,
  firstPlayer: 'X',
  mode: 'human-vs-human'
};
const engine = EngineFactory.createEngine(config3x3);
```

**Game State Management Ready:**
- Complete engine with factory pattern
- Configuration support for 3x3 and 4x4 boards
- Move validation and terminal state detection
- Ready for UI integration in next stories

### File Locations and Structure
[Source: docs/architecture/ADR-002-project-structure.md]

**New Implementation Files:**
- `apps/ui/src/app/pages/game/game.component.ts` - Main game page component
- `apps/ui/src/app/pages/game/game.component.html` - Game page template
- `apps/ui/src/app/pages/game/game.component.scss` - Game page styles
- `apps/ui/src/app/pages/game/game.component.spec.ts` - Game page tests
- `apps/ui/src/app/pages/credits/credits.component.ts` - Credits page component
- `apps/ui/src/app/pages/credits/credits.component.html` - Credits page template
- `apps/ui/src/app/pages/credits/credits.component.scss` - Credits page styles
- `apps/ui/src/app/pages/credits/credits.component.spec.ts` - Credits page tests
- `apps/ui/src/app/components/navigation/navigation.component.ts` - Navigation component

**Files to Update:**
- `apps/ui/src/app/app.routes.ts` - Add all three required routes
- `apps/ui/src/app/app.ts` - Update with navigation shell and router outlet
- `apps/ui/src/styles/globals.scss` - Add responsive CSS custom properties
- `apps/ui/tailwind.config.js` - Verify grid configuration for responsive boards

**Files to Verify:**
- `apps/ui/src/app/pages/health/health.component.ts` - Ensure integration with new routing
- `apps/ui/src/app/app.config.ts` - Verify routing configuration setup

### Testing

#### Testing Standards
[Source: docs/ui-architecture/testing-requirements.md#unit-testing]

**Unit Testing Requirements:**
- **Framework**: Jest with Angular testing utilities
- **Location**: Test files co-located with components (`.spec.ts`)
- **Coverage**: All public component methods and template interactions
- **Patterns**: Use Angular Testing Library for user-centric testing approach

**Component Testing Strategy:**
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';
import { GameComponent } from './game.component';

describe('GameComponent', () => {
  let component: GameComponent;
  let fixture: ComponentFixture<GameComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [GameComponent, RouterTestingModule]
    }).compileComponents();

    fixture = TestBed.createComponent(GameComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create game page', () => {
    expect(component).toBeTruthy();
  });

  it('should render centered board container', () => {
    const compiled = fixture.nativeElement as HTMLElement;
    const boardContainer = compiled.querySelector('[data-testid="game-board-container"]');
    expect(boardContainer).toBeTruthy();
  });

  it('should render inline controls', () => {
    const compiled = fixture.nativeElement as HTMLElement;
    const controls = compiled.querySelector('[data-testid="game-controls"]');
    expect(controls).toBeTruthy();
  });
});
```

**Routing Testing Requirements:**
```typescript
import { Router } from '@angular/router';
import { Location } from '@angular/common';
import { TestBed } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';

describe('Routing', () => {
  let router: Router;
  let location: Location;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [RouterTestingModule.withRoutes(appRoutes)]
    });

    router = TestBed.inject(Router);
    location = TestBed.inject(Location);
  });

  it('should navigate to game page by default', async () => {
    await router.navigate(['']);
    expect(location.path()).toBe('');
  });

  it('should navigate to health page', async () => {
    await router.navigate(['/health']);
    expect(location.path()).toBe('/health');
  });

  it('should navigate to credits page', async () => {
    await router.navigate(['/credits']);
    expect(location.path()).toBe('/credits');
  });
});
```

**Responsive Testing Strategy:**
- Test component rendering at different viewport sizes
- Verify CSS custom properties work correctly
- Test grid layout adjustments for 3x3 vs 4x4
- Validate square cell ratio maintenance
- Test navigation usability on mobile devices

**E2E Testing Requirements:**
```typescript
// apps/ui-e2e/src/routing.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Page Navigation', () => {
  test('should navigate between all pages', async ({ page }) => {
    await page.goto('/');
    
    // Test game page loads
    await expect(page.locator('[data-testid="game-page"]')).toBeVisible();
    
    // Navigate to health page
    await page.click('a[href="/health"]');
    await expect(page.locator('[data-testid="health-page"]')).toBeVisible();
    
    // Navigate to credits page
    await page.click('a[href="/credits"]');
    await expect(page.locator('[data-testid="credits-page"]')).toBeVisible();
    
    // Navigate back to game
    await page.click('a[href="/"]');
    await expect(page.locator('[data-testid="game-page"]')).toBeVisible();
  });

  test('should maintain responsive layout on mobile', async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 });
    await page.goto('/');
    
    const boardContainer = page.locator('[data-testid="game-board-container"]');
    await expect(boardContainer).toBeVisible();
    
    // Verify board maintains square ratio
    const boundingBox = await boardContainer.boundingBox();
    expect(boundingBox).toBeTruthy();
  });
});
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-25 | 1.0 | Initial story creation from Epic 3.1 | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

## QA Results

*This section will be populated by the QA agent after implementation review*